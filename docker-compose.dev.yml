services:
  backend:
    build:
      context: .
      dockerfile: Dockerfile
      target: base
    container_name: opencode-backend-dev
    command: sh -c "cd /app && bun --watch backend/src/index.ts"
    ports:
      - "5003:5003"
    environment:
      - NODE_ENV=development
      - HOST=0.0.0.0
      - PORT=5003
      - OPENCODE_SERVER_PORT=5551
      - DATABASE_PATH=/app/data/opencode.db
      - WORKSPACE_PATH=/workspace
      - DEBUG=true
    volumes:
      - ./backend:/app/backend
      - ./shared:/app/shared
      - opencode-workspace-dev:/workspace
      - opencode-data-dev:/app/data
    restart: unless-stopped

  frontend:
    build:
      context: .
      dockerfile: Dockerfile
      target: base
    container_name: opencode-frontend-dev
    command: sh -c "cd /app/frontend && npm run dev -- --host 0.0.0.0"
    ports:
      - "5173:5173"
    environment:
      - VITE_API_URL=http://localhost:5003
    volumes:
      - ./frontend:/app/frontend
      - ./shared:/app/shared
    depends_on:
      - backend
    restart: unless-stopped

volumes:
  opencode-workspace-dev:
    driver: local
  opencode-data-dev:
    driver: local
